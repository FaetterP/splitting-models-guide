# Гайд по разбиению модели на части

Пусть изначально имеется только файл с моделью и папка с текстурами: 
![image](https://user-images.githubusercontent.com/56697273/186213178-92c1964e-6b0d-49be-bd0d-a84d6e5807a3.png)

## Извлечение материалов
Чтобы извлечь материалы, можно воспользоваться стандартными возможностями Unity.     
Для этого необходимо выбрать файл с моделью, а затем в инспекторе нажать ```Extract materials```.     
![image](https://user-images.githubusercontent.com/56697273/186213360-f628b1f8-60db-45c1-a19e-fd1141a1760d.png)     
Далее выбираем папку, в которую хотим поместить материалы.     
В итоге получается следующее:     
![image](https://user-images.githubusercontent.com/56697273/186220772-c60aa1bc-7232-47e1-874f-cc00d3a97efa.png)

## Извлечение мешей
Чтобы разбить файл на несколько частей, нужно установить в проект файл, который находится в этом репозитории. Для этого достаточно просто разместить его где-то в проекте.     
**Внимание**! Пока этот файл активен, сборка проекта может не проходить, поэтому на время сборки этот файл лучше удалять.     
![image](https://user-images.githubusercontent.com/56697273/186236328-0b9327cb-1779-424f-b5c6-999d94ce8eb4.png)     
Дело в том, что здесь используются фичи редактора, которого, очевидно, нет в сборке.     

Если файл успешно загружен, то можно нажать ПКМ на модель и там появится пункт ```Extract Mmeshes```.     
![image](https://user-images.githubusercontent.com/56697273/186213060-c3f93c1e-daf3-4b1a-a6dc-b363736824d9.png)     
После нажатия вместо файла с появится папка с таким же названием, а внутри будет оригинал модели и папка со всеми мешами.     
![image](https://user-images.githubusercontent.com/56697273/186234892-9462c675-5115-4b2f-9c54-24a54f75f628.png)     
     
Чтобы окончательно разорвать связь с моделью, требуется собрать префаб уже из полученных материалов и мешей.     
Для этого нужно переместить оригинальную модель на сцену. Далее нужно нажать на неё ПКМ и выбрать ```Prefab -> Unpack```.     
![image](https://user-images.githubusercontent.com/56697273/186237431-63c5a4b1-3d3b-4268-b52e-36986dfa0795.png)
Затем самая муторная часть: нужно пройтись по всем элементам и заменить тот меш, который там стоит сейчас (этот меш от оригинальной модели) на такой же полученный чуть ранее. Визуально ничего не изменится, но и не должно, потому что вы заменяете меш таким же мешем.     
     
Также, прежде чем удалять оригинальную модель следует убедиться в том, что к частям на сцене применены **извлечённые** материалы. Для этого можно ввыбрать деталь и нажать на сам материал. Он подстветится в окне с файлами.     
Если всё сделано верно, то модель можно удалять. Главное не забыть создать префаб новой модели.   
Ну и нужно навести порядок в папках:     
![image](https://user-images.githubusercontent.com/56697273/186240503-31f64974-d028-4300-b556-8e5e8d366a7d.png)

## Зачем это всё?
У такого подхода есть несколько плюсов:
+ Столкнулся я с этой проблемой, когда мне дали .fbx-файл, который весит 500 Мб, а на гитхаб можно загружать только файлы весом до 200 Мб. Сейчас же модель хранится по частям и гитхаб её спокойно принимает. *(если какая-то деталь весит более 200 Мб, то все претензии к вашему 3д-модельеру)*
+ Также очень замедляло разработку и то, что большие модели импортировались, без шуток, 40 минут (хотя комп не самый плохой). Мелкие же модели загружаются быстрее.
+ Также не самый очевидный плюс в том, что если потребуется заменить какую-то текстурку, то это приведёт к переимпорту всей модели (а это значит, что придётся ждать ещё полчаса). Ообенно раздражало, когда импортируешь модель, а Unity говорит, что есть карты нормалей, и их можно применить. Применяешь и опять ждёшь.
+ Также в оригинальной модели нельзя менять материалы, потому что они вшиты в саму модель. После извлечения их, они живут сами по себе и их можно спокойно изменять. Также из этого вытекает, что если мы меняем текстурку, то меняется не вся модель, а только один материал, что происходит очень быстро.
     
Но у такого подхода есть минусы:
+ Нужно посидеть и потратить время на то, чтобы поставить новые меши вместо старых, и нигде не промахнуться. Также отдельная боль, когда удаляешь старую модель и понимаешь, что что-то пропустил. Приходтся доставать модель их корзины и искать ошибку.
+ Если ваш 3d-artist вдруг переделает модель, то придётся вот так изголяться каждый раз. Так ещё и придётся заменять все префабы на сценах на новый. В то же время при полноценных моделях всё делалось само. *(хотя не буду врать, тут я не уверен)*

_____
*файл в репозитории не мой, но я не помню, где я его нашёл*
